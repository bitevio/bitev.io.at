const fastify = require('fastify')({logger: true})
const path = require('path')
const fs =require("fs")
const beautify =require("js-beautify").js

const apps={
    at:{
        name:'Attendance Manangement system',
        dir:'at/spa/'
    }
}

function writeCoreFile(env_,app=apps.at){

var coreEnv =`
const config ={
    env:${JSON.stringify(env_)}
}
`
const filedir = cleanPath(process.cwd()+'/node_modules/bitev.io.app/'+app.dir+'core/')

fs.writeFileSync(filedir+"config.js",
    beautify(coreEnv,{
      "indent_size": 4,
    })
    ,()=>{})
}

function cleanPath(link) {
    let Path = link.replace(/\\/g, "/");
   // Path = Path.replace("/node_modules/bitev.io", "");
  
    return Path;
}

function start(config={
    port:3000,
    app:apps.at,
    env:{
            key:'',
            api:'http://localhost:5005/api'
    }
}){

    writeCoreFile(config.env,config.app)

    fastify.register(require('@fastify/static'), {
        root: path.join(__dirname, config.app.dir),
        prefix: '/', // optional: default '/'
    })
    
    fastify.listen({ port: Number(config.port) }, (err, address) => {
        if (err) throw err
        // Server is now listening on ${address}
       
    })

}



module.exports ={
    start,
    apps
}