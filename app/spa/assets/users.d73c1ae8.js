import{L as ee,r as x,c as E,w as te,o as Y,l as le,h as _,ap as me,au as fe,bB as pe,b3 as ge,g as ve,bV as _e,aj as he,P as ye,bn as be,bW as we,bX as xe,bx as j,m as K,bF as L,aq as f,aF as V,as as o,f as e,ax as ae,ay as z,B as U,V as C,aE as oe,aA as G,av as W,aC as se,at as r,bY as Ce,C as ke,ar as Q,aw as T,bZ as Qe,bA as B,bv as ne,az as ie,E as k,Q as M,F as re,a7 as ce,u as Se,aD as $e,b_ as Te,bz as Ve,bI as Fe,aW as Le,aU as Pe,aV as X,b5 as qe,by as Re}from"./index.4734a098.js";import{Q as Z}from"./QToolbar.caf7b8f3.js";import{Q as Ie}from"./QHeader.a6d3edf9.js";import{T as Be}from"./TouchPan.e6c3a7cf.js";import{n as I,c as De,d as Ee,T as Me,Q as A}from"./FaceMatcher.3c1f14ce.js";import{Q as ze}from"./QPageSticky.aa0e8f00.js";import{Q as Ue}from"./QPage.fb223cef.js";import{u as Ne}from"./use-dialog-plugin-component.14f70915.js";import{b as J}from"./route-block.b5bad31b.js";import"./touch.70a9dd44.js";const F=40,H=20;var Oe=ee({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:{default:void 0}},emits:["refresh"],setup(d,{slots:m,emit:h}){const{proxy:c}=ve(),{$q:y}=c,t=x("pull"),l=x(0),i=x(!1),p=x(-F),n=x(!1),b=x({}),s=E(()=>({opacity:l.value,transform:`translateY(${p.value}px) rotate(${l.value*360}deg)`})),a=E(()=>"q-pull-to-refresh__puller row flex-center"+(n.value===!0?" q-pull-to-refresh__puller--animating":"")+(d.bgColor!==void 0?` bg-${d.bgColor}`:""));function g(v){if(v.isFinal===!0){i.value===!0&&(i.value=!1,t.value==="pulled"?(t.value="refreshing",$({pos:H}),u()):t.value==="pull"&&$({pos:-F,ratio:0}));return}if(n.value===!0||t.value==="refreshing")return!1;if(v.isFirst===!0){if(_e(D)!==0||v.direction!=="down")return i.value===!0&&(i.value=!1,t.value="pull",$({pos:-F,ratio:0})),!1;i.value=!0;const{top:ue,left:de}=P.getBoundingClientRect();b.value={top:ue+"px",left:de+"px",width:window.getComputedStyle(P).getPropertyValue("width")}}he(v.evt);const q=Math.min(140,Math.max(0,v.distance.y));p.value=q-F,l.value=ye(q/(H+F),0,1);const R=p.value>H?"pulled":"pull";t.value!==R&&(t.value=R)}const w=E(()=>{const v={down:!0};return d.noMouse!==!0&&(v.mouse=!0),[[Be,g,void 0,v]]}),S=E(()=>`q-pull-to-refresh__content${i.value===!0?" no-pointer-events":""}`);function u(){h("refresh",()=>{$({pos:-F,ratio:0},()=>{t.value="pull"})})}function $({pos:v,ratio:q},R){n.value=!0,p.value=v,q!==void 0&&(l.value=q),clearTimeout(N),N=setTimeout(()=>{n.value=!1,R&&R()},300)}let P,D,N;function O(){D=be(P,d.scrollTarget)}return te(()=>d.scrollTarget,O),Y(()=>{P=c.$el,O()}),le(()=>{clearTimeout(N)}),Object.assign(c,{trigger:u,updateScrollTarget:O}),()=>{const v=[_("div",{class:S.value},me(m.default)),_("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:b.value},[_("div",{class:a.value,style:s.value},[t.value!=="refreshing"?_(fe,{name:d.icon||y.iconSet.pullToRefresh.icon,color:d.color,size:"32px"}):_(pe,{size:"24px",color:d.color})])])];return ge("div",{class:"q-pull-to-refresh"},v,"main",d.disable===!1,()=>w.value)}}});const Ae=[_("g",{transform:"translate(-20,-20)"},[_("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[_("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),_("g",{transform:"translate(20,20) rotate(15 50 50)"},[_("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[_("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])];var He=ee({name:"QSpinnerGears",props:we,setup(d){const{cSize:m,classes:h}=xe(d);return()=>_("svg",{class:h.value,width:m.value,height:m.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},Ae)}});const Ge={class:"hidden"},Ye={style:{height:"50vh"},class:"relative-position scroll text-center"},je=["src"],Ke={key:0,class:"text-center"},We={key:0,class:"text-bold"},Xe={key:1,class:"text-center"},Ze=r("p",null,"D\xE9tection en cours....",-1),Je={class:"fit text-center q-gutter-md"},et={__name:"addPhoto",setup(d){const m=x(null),h=j(),c=x(null),y=x(null),t=K({isReady:!1,score:0,img:[],loading:!1,items:[],height:window.innerHeight,stream:null,openPhoto:!1,onDetect:null});te(()=>t.img,s=>{console.log(s),s.length&&i()}),le(()=>{t.onDetect&&clearInterval(t.onDetect)}),Y(async()=>{t.isReady=!0,await p(),t.isReady=!1});function l(){t.score=0,t.img=[],setTimeout(()=>{y.value.chooseFile()},400)}const i=async()=>{t.loading=!0,c.value.addEventListener("load",async()=>{t.score=0,await n(),t.loading=!1})};async function p(){var s="/models";await Promise.all([I.ssdMobilenetv1.loadFromUri(s),I.tinyFaceDetector.loadFromUri(s),I.faceExpressionNet.loadFromUri(s),I.faceLandmark68Net.loadFromUri(s),I.faceRecognitionNet.loadFromUri(s)]).catch(a=>{console.log(a)})}async function n(){var g;const s=document.getElementById("img");De(s),document.getElementById("section");const a=await Ee(s,new Me).withFaceLandmarks().withFaceDescriptor();a&&(console.log(a),t.score=(g=a==null?void 0:a.detection)==null?void 0:g._score)}async function b(){h.loading.show();var s=await B.upload(t.img).then(a=>a).catch(a=>[]);m.value.onDialogOK(s),h.loading.hide()}return(s,a)=>{const g=L("van-uploader"),w=L("q-smart-dialog");return f(),V(w,{position:"bottom",maximized:"",ref_key:"dialogRef",ref:m,class:"flex fit flex-center",padding:""},{default:o(()=>[e(ae,null,{default:o(()=>[e(z,null,{default:o(()=>[U(e(C,{flat:"",round:"",icon:"mdi-close"},null,512),[[oe]]),e(G),t.score>.9?(f(),V(C,{key:0,onClick:b,round:"",color:"green",icon:"mdi-check"})):W("",!0)]),_:1}),e(se,{id:"section",style:{height:"65vh"},class:"scroll"},{default:o(()=>{var S;return[r("div",Ge,[e(g,{modelValue:t.img,"onUpdate:modelValue":a[0]||(a[0]=u=>t.img=u),"max-count":1,ref_key:"pick",ref:y},null,8,["modelValue"])]),e(Ce,{class:"fit",showing:t.isReady},{default:o(()=>[e(He,{size:"50px",color:"primary"})]),_:1},8,["showing"]),r("div",Ye,[U(r("img",{src:(S=t.img[0])==null?void 0:S.content,style:{height:"48vh"},id:"img",ref_key:"img",ref:c,alt:""},null,8,je),[[ke,t.img.length]])]),t.loading?(f(),Q("div",Xe,[e(Qe,{color:"primary",size:"2rem",thickness:5}),Ze])):(f(),Q("div",Ke,[t.score>.5?(f(),Q("span",We,"Score : "+T(Number(t.score).toFixed(2)),1)):W("",!0)]))]}),_:1}),e(z,{class:"q-pa-md bg-white text-white"},{default:o(()=>[r("div",Je,[e(C,{onClick:a[1]||(a[1]=S=>l()),color:"primary",class:"fit",label:"Capturer",unelevated:"",icon:"las la-portrait"})])]),_:1})]),_:1})]),_:1},512)}}},tt={class:"text-center"},lt={class:"text-center"},at=["src"],ot=r("p",null,[k(" Minimum 3 photos descriptives "),r("br"),k(" avec un socre de "),r("b",{class:"text-red"},"0.90>")],-1),st=r("div",{class:"shadow-1"},null,-1),nt={__name:"addUser",props:{item:null},setup(d){var n,b;const m=d,{dialogRef:h,onDialogOK:c}=Ne(),y=ne(),t=j(),l=K({loading:!1,imgs:[],entry:{centreId:(b=(n=y.device)==null?void 0:n.centre)==null?void 0:b.id,first_name:"",last_name:"",contact:null,email:null,facials:[]}});m.item&&(l.entry={...m.item});async function i(){var s={...l.entry};if(s=Te.omit(s,["centre"]),l.loading=!0,m.item)var a=await B.updateOne("employees",{where:{id:m.item.id},data:s}).then(g=>g).catch(g=>g);else var a=await B.createOne("employees",{data:s}).then(w=>w).catch(w=>w);a.id?c():t.notify({message:"Service indisponible"}),l.loading=!1}function p(){t.dialog({component:et}).onOk(s=>{l.entry.facials.push(s)})}return(s,a)=>{const g=L("van-divider"),w=L("n-carousel-item"),S=L("n-carousel");return f(),V($e,{ref_key:"dialogRef",ref:h,"transition-show":"slide-left","transition-hide":"slide-right",maximized:""},{default:o(()=>[e(ae,null,{default:o(()=>[e(z,null,{default:o(()=>[U(e(C,{round:"",flat:"",icon:"mdi-arrow-left"},null,512),[[oe]]),e(ie,null,{default:o(()=>[k(T(m.item?"Edition ":"Cr\xE9ation ")+" Employ\xE9 ",1)]),_:1})]),_:1}),e(se,{style:{height:"85vh"},class:"scroll"},{default:o(()=>[r("div",tt,[e(g,{class:"text-bold text-black"},{default:o(()=>[k(" Informations personnelles")]),_:1}),e(M,{modelValue:l.entry.first_name,"onUpdate:modelValue":a[0]||(a[0]=u=>l.entry.first_name=u),type:"text",label:"Nom"},null,8,["modelValue"]),e(M,{modelValue:l.entry.last_name,"onUpdate:modelValue":a[1]||(a[1]=u=>l.entry.last_name=u),type:"text",label:"Prenom"},null,8,["modelValue"]),e(M,{modelValue:l.entry.email,"onUpdate:modelValue":a[2]||(a[2]=u=>l.entry.email=u),type:"text",label:"E-mail"},null,8,["modelValue"]),e(M,{modelValue:l.entry.contact,"onUpdate:modelValue":a[3]||(a[3]=u=>l.entry.contact=u),type:"text",label:"Contact"},null,8,["modelValue"]),e(g,{class:"text-bold text-black"},{default:o(()=>[k(" Reconnaissance faciale")]),_:1}),e(S,{loop:!1,"slides-per-view":1},{default:o(()=>[(f(!0),Q(re,null,ce(l.entry.facials,(u,$)=>(f(),V(w,{style:{height:"40vh"},key:$},{default:o(()=>[r("div",lt,[r("div",null,[r("img",{style:{width:"auto",height:"30vh"},src:Se(B).assets(u.filedisk)},null,8,at)]),e(C,{dense:"",flat:"",onClick:P=>l.entry.facials=l.entry.facials.filter(D=>D.id!==u.id),"no-caps":"",icon:"mdi-close",label:`(${$+1}/ ${l.entry.facials.length}) Supprimer`},null,8,["onClick","label"])])]),_:2},1024))),128))]),_:1}),ot,st,e(C,{onClick:p,outline:"",icon:"mdi-camera-plus",label:"Capturer"})])]),_:1}),e(z,null,{default:o(()=>[e(C,{loading:l.loading,icon:"las la-save",color:"primary",onClick:a[4]||(a[4]=u=>i()),class:"fit",label:"Enregistrer"},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)}}},it={key:0},rt={key:1},ct={key:1},ut={class:"q-pa-lg"},dt={class:"q-col-qutter-md"},mt={class:"q-pt-md"},ft={class:"q-pt-md"},pt={__name:"users",setup(d){const m=ne(),h=j(),c=K({loading:!1,items:[]});Y(()=>{y()});async function y(l){var i,p;c.loading=!0,c.items=await B.findMany("employees",{orderBy:{first_name:"asc"},where:{centre:{id:{equals:(p=(i=m.device)==null?void 0:i.centre)==null?void 0:p.id}}}}).then(n=>n).catch(n=>[]),console.log(c.items),c.loading=!1,l&&l()}function t(l=null){h.dialog({component:nt,componentProps:{item:l}}).onOk(()=>{y()})}return(l,i)=>{const p=L("van-empty");return f(),V(Re,null,{default:o(()=>[e(Ie,null,{default:o(()=>[e(Z,{class:"text-black bg-white"},{default:o(()=>[e(ie,{shrink:""},{default:o(()=>[k(" Liste des employ\xE9s ")]),_:1}),e(G),e(C,{onClick:i[0]||(i[0]=n=>l.$router.back()),flat:"",round:"",dense:"",icon:"mdi-arrow-left"})]),_:1})]),_:1}),e(Ve,null,{default:o(()=>[e(Ue,null,{default:o(()=>[e(Z,{class:"text-caption"},{default:o(()=>[e(G),k(" "+T(c.items.length)+" El\xE9ments trouv\xE9s ",1)]),_:1}),c.loading?(f(),Q("div",ct,[r("div",ut,[r("div",dt,[r("div",null,[e(A,{type:"QRadio"})]),r("div",mt,[e(A)]),r("div",ft,[e(A,{class:"q-pt-md",style:{height:"60vh"}})])])])])):(f(),V(Oe,{key:0,onRefresh:y},{default:o(()=>[c.items.length?(f(),Q("div",rt,[e(Fe,{separator:""},{default:o(()=>[(f(!0),Q(re,null,ce(c.items,(n,b)=>U((f(),V(Le,{clickable:"",onClick:s=>t(n),key:b},{default:o(()=>[e(Pe,null,{default:o(()=>[e(X,{class:"text-bold"},{default:o(()=>[k(T(n.first_name)+" "+T(n.last_name),1)]),_:2},1024),e(X,{class:"text-caption"},{default:o(()=>[k(T(n.contact)+" "+T(n.email),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[qe]])),128))]),_:1})])):(f(),Q("div",it,[e(p,{description:"Aucun personnelle"})]))]),_:1})),e(ze,{offset:[18,18],position:"bottom-right"},{default:o(()=>[e(C,{onClick:i[1]||(i[1]=n=>t()),color:"primary",fab:"",icon:"mdi-plus"})]),_:1})]),_:1})]),_:1})]),_:1})}}};typeof J=="function"&&J(pt);export{pt as default};
