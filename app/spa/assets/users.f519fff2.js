import{L as ee,r as b,c as E,w as te,o as G,l as le,h,ap as de,au as me,bB as fe,b3 as pe,g as ge,bV as ve,aj as _e,P as he,bn as ye,bW as be,bX as xe,bx as Y,m as j,bF as F,aq as f,aF as Q,as as l,f as t,ax as ae,ay as M,B as z,V as x,aE as oe,aA as H,av as W,aC as se,at as r,bY as Ce,C as we,ar as w,aw as k,bZ as ke,bA as R,az as ne,E as C,Q as I,F as ie,a7 as re,u as Qe,aD as Se,bz as $e,bI as Te,aW as Ve,aU as Fe,aV as X,b5 as Le,by as Pe}from"./index.968208bb.js";import{Q as Z}from"./QToolbar.9db00689.js";import{Q as qe}from"./QHeader.fd1ddaf8.js";import{T as Re}from"./TouchPan.83e0a82f.js";import{n as q,c as Be,d as De,T as Ee,Q as O}from"./FaceMatcher.05aa56ad.js";import{Q as Ie}from"./QPageSticky.3ae1a21d.js";import{Q as Me}from"./QPage.a94fc083.js";import{u as ze}from"./use-dialog-plugin-component.8b0e429c.js";import{b as J}from"./route-block.b5bad31b.js";import"./touch.70a9dd44.js";const V=40,A=20;var Ue=ee({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:{default:void 0}},emits:["refresh"],setup(d,{slots:m,emit:c}){const{proxy:p}=ge(),{$q:y}=p,e=b("pull"),u=b(0),g=b(!1),s=b(-V),a=b(!1),v=b({}),o=E(()=>({opacity:u.value,transform:`translateY(${s.value}px) rotate(${u.value*360}deg)`})),n=E(()=>"q-pull-to-refresh__puller row flex-center"+(a.value===!0?" q-pull-to-refresh__puller--animating":"")+(d.bgColor!==void 0?` bg-${d.bgColor}`:""));function i(_){if(_.isFinal===!0){g.value===!0&&(g.value=!1,e.value==="pulled"?(e.value="refreshing",B({pos:A}),T()):e.value==="pull"&&B({pos:-V,ratio:0}));return}if(a.value===!0||e.value==="refreshing")return!1;if(_.isFirst===!0){if(ve(K)!==0||_.direction!=="down")return g.value===!0&&(g.value=!1,e.value="pull",B({pos:-V,ratio:0})),!1;g.value=!0;const{top:ce,left:ue}=D.getBoundingClientRect();v.value={top:ce+"px",left:ue+"px",width:window.getComputedStyle(D).getPropertyValue("width")}}_e(_.evt);const L=Math.min(140,Math.max(0,_.distance.y));s.value=L-V,u.value=he(L/(A+V),0,1);const P=s.value>A?"pulled":"pull";e.value!==P&&(e.value=P)}const S=E(()=>{const _={down:!0};return d.noMouse!==!0&&(_.mouse=!0),[[Re,i,void 0,_]]}),$=E(()=>`q-pull-to-refresh__content${g.value===!0?" no-pointer-events":""}`);function T(){c("refresh",()=>{B({pos:-V,ratio:0},()=>{e.value="pull"})})}function B({pos:_,ratio:L},P){a.value=!0,s.value=_,L!==void 0&&(u.value=L),clearTimeout(U),U=setTimeout(()=>{a.value=!1,P&&P()},300)}let D,K,U;function N(){K=ye(D,d.scrollTarget)}return te(()=>d.scrollTarget,N),G(()=>{D=p.$el,N()}),le(()=>{clearTimeout(U)}),Object.assign(p,{trigger:T,updateScrollTarget:N}),()=>{const _=[h("div",{class:$.value},de(m.default)),h("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:v.value},[h("div",{class:n.value,style:o.value},[e.value!=="refreshing"?h(me,{name:d.icon||y.iconSet.pullToRefresh.icon,color:d.color,size:"32px"}):h(fe,{size:"24px",color:d.color})])])];return pe("div",{class:"q-pull-to-refresh"},_,"main",d.disable===!1,()=>S.value)}}});const Ne=[h("g",{transform:"translate(-20,-20)"},[h("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[h("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),h("g",{transform:"translate(20,20) rotate(15 50 50)"},[h("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[h("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])];var Oe=ee({name:"QSpinnerGears",props:be,setup(d){const{cSize:m,classes:c}=xe(d);return()=>h("svg",{class:c.value,width:m.value,height:m.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},Ne)}});const Ae={class:"hidden"},He={style:{height:"50vh"},class:"relative-position scroll text-center"},Ge=["src"],Ye={key:0,class:"text-center"},je={key:0,class:"text-bold"},Ke={key:1,class:"text-center"},We=r("p",null,"D\xE9tection en cours....",-1),Xe={class:"fit text-center q-gutter-md"},Ze={__name:"addPhoto",setup(d){const m=b(null),c=Y(),p=b(null),y=b(null),e=j({isReady:!1,score:0,img:[],loading:!1,items:[],height:window.innerHeight,stream:null,openPhoto:!1,onDetect:null});te(()=>e.img,o=>{console.log(o),o.length&&g()}),le(()=>{e.onDetect&&clearInterval(e.onDetect)}),G(async()=>{e.isReady=!0,await s(),e.isReady=!1});function u(){e.score=0,e.img=[],setTimeout(()=>{y.value.chooseFile()},400)}const g=async()=>{e.loading=!0,p.value.addEventListener("load",async()=>{e.score=0,await a(),e.loading=!1})};async function s(){var o="/models";await Promise.all([q.ssdMobilenetv1.loadFromUri(o),q.tinyFaceDetector.loadFromUri(o),q.faceExpressionNet.loadFromUri(o),q.faceLandmark68Net.loadFromUri(o),q.faceRecognitionNet.loadFromUri(o)]).catch(n=>{console.log(n)})}async function a(){var i;const o=document.getElementById("img");Be(o),document.getElementById("section");const n=await De(o,new Ee).withFaceLandmarks().withFaceDescriptor();n&&(console.log(n),e.score=(i=n==null?void 0:n.detection)==null?void 0:i._score)}async function v(){c.loading.show();var o=await R.upload(e.img).then(n=>n).catch(n=>[]);m.value.onDialogOK(o),c.loading.hide()}return(o,n)=>{const i=F("van-uploader"),S=F("q-smart-dialog");return f(),Q(S,{position:"bottom",maximized:"",ref_key:"dialogRef",ref:m,class:"flex fit flex-center",padding:""},{default:l(()=>[t(ae,null,{default:l(()=>[t(M,null,{default:l(()=>[z(t(x,{flat:"",round:"",icon:"mdi-close"},null,512),[[oe]]),t(H),e.score>.9?(f(),Q(x,{key:0,onClick:v,round:"",color:"green",icon:"mdi-check"})):W("",!0)]),_:1}),t(se,{id:"section",style:{height:"65vh"},class:"scroll"},{default:l(()=>{var $;return[r("div",Ae,[t(i,{modelValue:e.img,"onUpdate:modelValue":n[0]||(n[0]=T=>e.img=T),"max-count":1,ref_key:"pick",ref:y},null,8,["modelValue"])]),t(Ce,{class:"fit",showing:e.isReady},{default:l(()=>[t(Oe,{size:"50px",color:"primary"})]),_:1},8,["showing"]),r("div",He,[z(r("img",{src:($=e.img[0])==null?void 0:$.content,style:{height:"48vh"},id:"img",ref_key:"img",ref:p,alt:""},null,8,Ge),[[we,e.img.length]])]),e.loading?(f(),w("div",Ke,[t(ke,{color:"primary",size:"2rem",thickness:5}),We])):(f(),w("div",Ye,[e.score>.5?(f(),w("span",je,"Score : "+k(Number(e.score).toFixed(2)),1)):W("",!0)]))]}),_:1}),t(M,{class:"q-pa-md bg-white text-white"},{default:l(()=>[r("div",Xe,[t(x,{onClick:n[1]||(n[1]=$=>u()),color:"primary",class:"fit",label:"Capturer",unelevated:"",icon:"las la-portrait"})])]),_:1})]),_:1})]),_:1},512)}}},Je={class:"text-center"},et={class:"text-center"},tt=["src"],lt=r("p",null,[C(" Minimum 3 photos descriptives "),r("br"),C(" avec un socre de "),r("b",{class:"text-red"},"0.90>")],-1),at=r("div",{class:"shadow-1"},null,-1),ot={__name:"addUser",props:{item:null},setup(d){const m=d,{dialogRef:c,onDialogOK:p}=ze(),y=Y(),e=j({loading:!1,imgs:[],entry:{first_name:"",last_name:"",contact:null,email:null,facials:[]}});m.item&&(e.entry={...m.item});async function u(){var s={...e.entry};if(e.loading=!0,m.item)var a=await R.updateOne("employees",{where:{id:m.item.id},data:s}).then(v=>v).catch(v=>v);else var a=await R.createOne("employees",{data:s}).then(o=>o).catch(o=>o);a.id?p():y.notify({message:"Service indisponible"}),e.loading=!1}function g(){y.dialog({component:Ze}).onOk(s=>{e.entry.facials.push(s)})}return(s,a)=>{const v=F("van-divider"),o=F("n-carousel-item"),n=F("n-carousel");return f(),Q(Se,{ref_key:"dialogRef",ref:c,"transition-show":"slide-left","transition-hide":"slide-right",maximized:""},{default:l(()=>[t(ae,null,{default:l(()=>[t(M,null,{default:l(()=>[z(t(x,{round:"",flat:"",icon:"mdi-arrow-left"},null,512),[[oe]]),t(ne,null,{default:l(()=>[C(k(m.item?"Edition ":"Cr\xE9ation ")+" Employ\xE9 ",1)]),_:1})]),_:1}),t(se,{style:{height:"85vh"},class:"scroll"},{default:l(()=>[r("div",Je,[t(v,{class:"text-bold text-black"},{default:l(()=>[C(" Informations personnelles")]),_:1}),t(I,{modelValue:e.entry.first_name,"onUpdate:modelValue":a[0]||(a[0]=i=>e.entry.first_name=i),type:"text",label:"Nom"},null,8,["modelValue"]),t(I,{modelValue:e.entry.last_name,"onUpdate:modelValue":a[1]||(a[1]=i=>e.entry.last_name=i),type:"text",label:"Prenom"},null,8,["modelValue"]),t(I,{modelValue:e.entry.email,"onUpdate:modelValue":a[2]||(a[2]=i=>e.entry.email=i),type:"text",label:"E-mail"},null,8,["modelValue"]),t(I,{modelValue:e.entry.contact,"onUpdate:modelValue":a[3]||(a[3]=i=>e.entry.contact=i),type:"text",label:"Contact"},null,8,["modelValue"]),t(v,{class:"text-bold text-black"},{default:l(()=>[C(" Reconnaissance faciale")]),_:1}),t(n,{loop:!1,"slides-per-view":1},{default:l(()=>[(f(!0),w(ie,null,re(e.entry.facials,(i,S)=>(f(),Q(o,{style:{height:"40vh"},key:S},{default:l(()=>[r("div",et,[r("div",null,[r("img",{style:{width:"auto",height:"30vh"},src:Qe(R).assets(i.filedisk)},null,8,tt)]),t(x,{dense:"",flat:"",onClick:$=>e.entry.facials=e.entry.facials.filter(T=>T.id!==i.id),"no-caps":"",icon:"mdi-close",label:`(${S+1}/ ${e.entry.facials.length}) Supprimer`},null,8,["onClick","label"])])]),_:2},1024))),128))]),_:1}),lt,at,t(x,{onClick:g,outline:"",icon:"mdi-camera-plus",label:"Capturer"})])]),_:1}),t(M,null,{default:l(()=>[t(x,{loading:e.loading,icon:"las la-save",color:"primary",onClick:a[4]||(a[4]=i=>u()),class:"fit",label:"Enregistrer"},null,8,["loading"])]),_:1})]),_:1})]),_:1},512)}}},st={key:0},nt={key:1},it={key:1},rt={class:"q-pa-lg"},ct={class:"q-col-qutter-md"},ut={class:"q-pt-md"},dt={class:"q-pt-md"},mt={__name:"users",setup(d){const m=Y(),c=j({loading:!1,items:[]});G(()=>{p()});async function p(e){c.loading=!0,c.items=await R.findMany("employees",{orderBy:{first_name:"asc"}}).then(u=>u).catch(u=>[]),console.log(c.items),c.loading=!1,e&&e()}function y(e=null){m.dialog({component:ot,componentProps:{item:e}}).onOk(()=>{p()})}return(e,u)=>{const g=F("van-empty");return f(),Q(Pe,null,{default:l(()=>[t(qe,null,{default:l(()=>[t(Z,{class:"text-black bg-white"},{default:l(()=>[t(ne,{shrink:""},{default:l(()=>[C(" Liste des employ\xE9s ")]),_:1}),t(H),t(x,{onClick:u[0]||(u[0]=s=>e.$router.back()),flat:"",round:"",dense:"",icon:"mdi-arrow-left"})]),_:1})]),_:1}),t($e,null,{default:l(()=>[t(Me,null,{default:l(()=>[t(Z,{class:"text-caption"},{default:l(()=>[t(H),C(" "+k(c.items.length)+" El\xE9ments trouv\xE9s ",1)]),_:1}),c.loading?(f(),w("div",it,[r("div",rt,[r("div",ct,[r("div",null,[t(O,{type:"QRadio"})]),r("div",ut,[t(O)]),r("div",dt,[t(O,{class:"q-pt-md",style:{height:"60vh"}})])])])])):(f(),Q(Ue,{key:0,onRefresh:p},{default:l(()=>[c.items.length?(f(),w("div",nt,[t(Te,{separator:""},{default:l(()=>[(f(!0),w(ie,null,re(c.items,(s,a)=>z((f(),Q(Ve,{clickable:"",onClick:v=>y(s),key:a},{default:l(()=>[t(Fe,null,{default:l(()=>[t(X,{class:"text-bold"},{default:l(()=>[C(k(s.first_name)+" "+k(s.last_name),1)]),_:2},1024),t(X,{class:"text-caption"},{default:l(()=>[C(k(s.contact)+" "+k(s.email),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Le]])),128))]),_:1})])):(f(),w("div",st,[t(g,{description:"Aucun personnelle"})]))]),_:1})),t(Ie,{offset:[18,18],position:"bottom-right"},{default:l(()=>[t(x,{onClick:u[1]||(u[1]=s=>y()),color:"primary",fab:"",icon:"mdi-plus"})]),_:1})]),_:1})]),_:1})]),_:1})}}};typeof J=="function"&&J(mt);export{mt as default};
